!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a():a(jQuery)}(function(a){"use strict";function i(a,b){this.element=a,this.options=b,this.init()}a.HjxCtrl||(a.HjxCtrl={}),a.HjxCtrl.autocomplete=!1,a.HjxCtrl.setAC=function(){a.HjxCtrl.autocomplete=!0},a.HjxCtrl.clearAC=function(){a.HjxCtrl.autocomplete=!1},a.HjxCtrl.getAC=function(){return a.HjxCtrl.autocomplete};var b="autocomplete-api",c=500,d=[],e=Array.prototype.slice,f=function(a){var b=Math.random().toString(36).substr(2);return("string"==typeof a?a:"")+b},g=function(b,c){var d=b.offset(),e=b.outerHeight(),f=b.outerWidth(),g=a(window),h=g.outerHeight(),i=g.outerWidth(),j=d.top-g.scrollTop(),k=!0,l={};return h/2>j?(l.top=d.top+e+1+"px",l.bottom="auto",d.left>i/2?(l.right=i-f-d.left+"px",l.left="auto"):(l.right="auto",l.left=d.left+"px")):(k=!1,l.top="auto",l.bottom=h-d.top+1+"px",d.left>i/2?(l.right=i-f-d.left+"px",l.left="auto"):(l.right="auto",l.left=d.left+"px")),c.css(l),k},h={multiple:!1,source:null,minlength:0,zIndex:null,placeholder:"\u8bf7\u9009\u62e9",prompt:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\u67e5\u8be2",empty:"\u65e0\u5339\u914d\u6570\u636e",size:null,width:null,dropdown:{},format:null,target:null,select:null,render:null,clear:null,change:null,freeze:null,unfreeze:null};i.prototype={constructor:i,author:"hujx",init:function(){var b=this,c=this.options.source,d=this.options.format||b.format;this.ex=null,this.isStatic="function"!=typeof c,this.isStatic&&(this.list=a.map(c,function(a){return d(a)})),this.options.multiple?(this.createTags(),this.listenTags()):(this.createDoms(),this.listen())},createDoms:function(){var b=f(),c="autocomplete_"+b,d="ac_dropdown_"+b,e=['<div class="autocomplete-view" id="'+c+'">','  <input type="text"  class="ac-search" autocomplete="false" />','  <div class="ac-label ac-place">'+this.options.placeholder+"</div>",'  <div class="ac-delete">&times;</div>','  <div class="ac-caret"></div>',"</div>"],g=['<div class="autocomplete-dropdown hide" id="'+d+'">','  <div class="ac-prompt">','    <div class="ac-prompt-text">'+this.options.prompt+"</div>",'    <div class="ac-loading"></div>',"  </div>",'  <div class="ac-result"></div>',"</div>"];this.element.after(e.join("")),a("body").append(g.join("")),this.viewer=a("#"+c),this.dropdowner=a("#"+d),this.searcher=this.viewer.find(".ac-search"),this.labeler=this.viewer.find(".ac-label"),this.resulter=this.dropdowner.find(".ac-result"),this.prompter=this.dropdowner.find(".ac-prompt");var h=this.element.data("autocomplete"),i=this.element.val();i&&(this.viewer.addClass("ac-has-value"),this.labeler.html(h||i).removeClass("ac-place"),this.ex={label:h||i,value:i});var j=this.options.width;j>0&&(this.viewer.css("width",j-2+"px"),this.searcher.css("width",j-40+"px"));var k=this.options.dropdown;k.width>0&&this.dropdowner.css("width",k.width-2+"px"),k.maxHeight>0&&this.resulter.css("maxHeight",k.maxHeight+"px")},listen:function(){var b=this;this.viewer.on("click.show-dropdown",".ac-label",function(){b.isFreeze||b.startEdit()}).on("click.toggle-dropdpwn",".ac-caret",function(){b.viewer.hasClass("ac-edit-view")?b.closeEdit():b.startEdit()}).on("click.clear-autocomplete",".ac-delete",function(){b.clear()}),this.searcher.on("keypress.autocomplete-api",function(a){if(13===a.keyCode){var c=b.resulter.find("li.active");c.length>0?b.select(b.cache[c.index()]).done(function(a){b.change(a).closeEdit()}):b.closeEdit(),a.preventDefault()}}).on("keydown.autocomplete-api",function(a){b.cache.length&&(38===a.keyCode?(b.up(),a.preventDefault()):40===a.keyCode&&(b.down(),a.preventDefault()))}),this.resulter.on("click.select-item","li",function(){b.select(b.cache[a(this).index()]).done(function(a){b.change(a).closeEdit()})})},createTags:function(){var b=f(),c="autocomplete_"+b,d="ac_dropdown_"+b,e=['<div class="autocomplete-view ac-tags" id="'+c+'">','  <input type="text" class="tags-search" autocomplete="false"/>','  <div class="tags-line"></div>',"</div>"],g=['<div class="autocomplete-dropdown hide" id="'+d+'">','  <div class="ac-prompt">','    <div class="ac-prompt-text">'+this.options.prompt+"</div>",'    <div class="ac-loading"></div>',"  </div>",'  <div class="ac-result"></div>',"</div>"];this.element.after(e.join("")),a("body").append(g.join("")),this.viewer=a("#"+c),this.dropdowner=a("#"+d),this.tagcart=this.viewer.find(".tags-cart"),this.searcher=this.viewer.find(".tags-search"),this.resulter=this.dropdowner.find(".ac-result"),this.prompter=this.dropdowner.find(".ac-prompt");var h=this.options.width;h>0&&this.viewer.css("width",h-2+"px");var i=this.options.dropdown;i.width>0&&this.dropdowner.css("width",i.width-2+"px"),i.maxHeight>0&&this.resulter.css("maxHeight",i.maxHeight+"px")},listenTags:function(){},up:function(){var a=this.resulter.find("li.active");this.resulter.find("ul").outerHeight();var c=this.resulter.scrollTop(),d=a.prev();a.removeClass("active"),0===d.length?(d=this.resulter.find("li").last(),this.resulter.scrollTop(this.resulter.outerHeight())):this.resulter.scrollTop(c-a.outerHeight()),d.addClass("active")},down:function(){var a=this.resulter.find("li.active");this.resulter.find("ul").outerHeight();var c=this.resulter.scrollTop(),d=a.next();a.removeClass("active"),0===d.length?(d=this.resulter.find("li").first(),this.resulter.scrollTop(0)):this.resulter.scrollTop(c+a.outerHeight()),d.addClass("active")},startEdit:function(){a.each(d,function(a,b){b.closeEdit()});var b=this;this.viewer.addClass("ac-edit-view"),this.searcher.val(this.ex?this.ex.label:"").select(),this.dropdowner.removeClass("hide"),this.isTopSide=g(this.viewer,this.dropdowner),0===this.options.minlength&&this.match(""),this.searchKey=this.searcher.val(),this.interval=window.setInterval(function(){b.searchKey!==b.searcher.val()&&b.searchKey.length>=b.options.minlength&&(b.searchKey=b.searcher.val(),b.match())},c)},match:function(){var b=[],c=[],d=this.highlight,e=this.options.target,f=this.searchKey,g=0,h=this.options.size,i=this.options.format||this.format,j=this;this.cache=[],this.resulter.empty(),this.isStatic?(a.each(this.list,function(a,i){var k="";return(!f||i.label.indexOf(f)>-1)&&(k="<li>"+j.render(i,f,d)+"</li>",j.isEqual(e||["label"],i,f)?b.push([i,k]):c.push([i,k]),g+=1,h&&g>=h)?!1:void 0}),this.display(b.concat(c))):(this.dropdowner.addClass("ac-is-loading"),this.search(f).done(function(b){j.list=a.map(b,function(a){return i(a)})}).done(function(){j.dropdowner.removeClass("ac-is-loading"),a.each(j.list,function(a,i){var k="<li>"+j.render(i,f,d)+"</li>";return e?j.isEqual(e,i,f)?b.push([i,k]):c.push([i,k]):b.push([i,k]),g+=1,h&&g>=h?!1:void 0}),j.display(b.concat(c))}))},search:function(b){var c=this.options.source,d=a.Deferred();return c(b,d.resolve),d.promise()},isEqual:function(b,c,d){return a.isArray(b)?a.map(b,function(a){return c[a]===d?1:0}).join("").indexOf("1")>-1:"string"==typeof b?c[b]===d:!1},display:function(b){b=this.isTopSide?b:b.reverse();var c=[],d=[];a.each(b,function(a,b){d.push(b[0]),c.push(b[1])}),this.cache=d,b.length>0?this.resulter.html("<ul>"+c.join("")+"</ul>"):this.resulter.html('<div class="ac-empty">'+this.options.empty+"</div>"),this.isTopSide?(this.resulter.before(this.prompter),this.dropdowner.removeClass("ac-result-reverse"),this.resulter.scrollTop(0),this.resulter.find("li").on("mouseenter",function(){a(this).addClass("active").siblings(".active").removeClass("active")}).first().addClass("active")):(this.resulter.after(this.prompter),this.dropdowner.addClass("ac-result-reverse"),this.resulter.scrollTop(this.resulter.find("ul").outerHeight()),this.resulter.find("li").on("mouseenter",function(){a(this).addClass("active").siblings(".active").removeClass("active")}).last().addClass("active"))},format:function(a){return{label:a,value:a,self:a}},render:function(a,b,c){var d=this.options.render;return"function"==typeof d?d(a,b,c):c(a.label,b)},highlight:function(a,b){if(b){var c=new RegExp("("+b+")","i");return a.replace(c,"<em>$1</em>")}return a},closeEdit:function(){this.viewer.removeClass("ac-edit-view"),this.dropdowner.addClass("hide"),this.searcher.val(""),this.searchKey="",this.resulter.empty(),window.clearInterval(this.interval)},clear:function(){return this.ex=null,this.element.val(""),this.labeler.html(this.options.placeholder).addClass("ac-place"),this.viewer.removeClass("ac-has-value"),(this.options.clear||function(){})(),this},change:function(a){return this.ex=a,this.element.val(a.value),this.labeler.html(a.label).removeClass("ac-place"),this.viewer.addClass("ac-has-value"),(this.options.change||function(){})(a),this},select:function(b){var c=this.options.select,d=a.Deferred();return a.isFunction(c)?c(b,d):d.resolve(b),d.promise()},freeze:function(){return this.viewer.addClass("freeze"),this.isFreeze=!0,this.searcher.attr("readonly","readonly"),(this.options.freeze||function(){})(),this},unfreeze:function(){return this.viewer.removeClass("freeze"),this.isFreeze=!1,this.searcher.removeAttr("readonly"),(this.options.unfreeze||function(){})(),this},get:function(){if(this.options.multiple)return[];var a=this.ex||{};return{label:a.label||"",value:a.value||""}},set:function(a){return this.options.multiple||(this.labeler.text(a.label).removeClass("ac-place"),this.element.val(a.value),this.ex=[{label:a.label,value:a.value}]),this},placeholder:function(a){return this.options.placeholder=a,this.labeler.hasClass("ac-place")&&this.labeler.html(a),this},noop:function(){return this}},a.fn.autocomplete=function(){var c=e.call(arguments,0),f=c[0],g=this.data(b),j="string"==typeof f?f:"noop";return g||(f="string"==typeof f?h:a.extend(!0,{},h,f||{}),this.data(b,g=new i(this,f)),d.push(g)),g[j].apply(g,c.slice(1))},a(document).on("click.autocomplete-api",function(){a.HjxCtrl.getAC()||a.each(d,function(a,b){b.closeEdit()}),a.HjxCtrl.clearAC()}).on("click.autocomplete-api",".autocomplete-view",function(){a.HjxCtrl.setAC()}).on("click.autocomplete-api",".autocomplete-dropdown",function(a){a.stopPropagation()})});