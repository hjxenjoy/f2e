(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($){"use strict";var incal=false;var namespace="calendar-api";var _slice=Array.prototype.slice;var _toString=Object.prototype.toString;var dateTemplate="yyyy-MM-dd hh:mm:ss";var dataDateTemp="yyyyMMdd";var weekText="日 一 二 三 四 五 六";var monthText="一月 二月 三月 四月 五月 六月 七月 八月 九月 十月 十一月 十二月";var timeTip=["如何修改时间","点击下方时间框，使用键盘上下方向键调整时间"];var config={style:null,size:0,active:false,closable:true,enable:new Array(2),zIndex:798,format:dateTemplate,date:null,weekStart:0,weekText:weekText,monthText:monthText,timeText:"时分秒",time:false,timeTip:timeTip,todayBtn:false,todayText:"今天",clearBtn:false,clearText:"清除",sureText:"确定",clear:null,change:null,after:null,dateClick:null,dateMouseover:null,dateMouseleave:null};var viewMode={month:"VIEW_MODE_MONTH",year:"VIEW_MODE_YEAR",ten:"VIEW_MODE_TEN",century:"VIEW_MODE_CENTURY"};var today=new Date;var Utils={random:function(prefix){return(prefix||"")+Math.random().toString(36).substr(2)},isDate:function(target){return _toString.call(target)==="[object Date]"},lenNum:function(target){return target>9?""+target:"0"+target},formatDate:function(target,format){format=format||dateTemplate;var result=format.replace(/yyyy/,target.getFullYear());result=result.replace(/MM/,this.lenNum(target.getMonth()+1));result=result.replace(/dd/,this.lenNum(target.getDate()));result=result.replace(/hh/,this.lenNum(target.getHours()));result=result.replace(/mm/,this.lenNum(target.getMinutes()));return result.replace(/ss/,this.lenNum(target.getSeconds()))},toDate:function(target,format){var result=new Date;if(!target){return result}target=target.toString();format=format||dateTemplate;var yearIndex=format.indexOf("yyyy");var monthIndex=format.indexOf("MM");var dateIndex=format.indexOf("dd");var hourIndex=format.indexOf("hh");var minuteIndex=format.indexOf("mm");var secondIndex=format.indexOf("ss");var length=target.length+1;var year=1970,month=0,date=1,hour=0,minute=0,second=0;if(yearIndex>-1&&length>yearIndex+4){year=target.substr(yearIndex,4)-0}if(monthIndex>-1&&length>monthIndex+2){month=target.substr(monthIndex,2)-1}if(dateIndex>-1&&length>dateIndex+2){date=target.substr(dateIndex,2)-0}if(hourIndex>-1&&length>hourIndex+2){hour=target.substr(hourIndex,2)-0}if(minuteIndex>-1&&length>minuteIndex+2){minute=target.substr(minuteIndex,2)-0}if(secondIndex>-1&&length>secondIndex+2){second=target.substr(secondIndex,2)-0}result.setFullYear(year,month,date);result.setHours(hour,minute,second);return result},date2Str:function(date,format,size){format=format||dateTemplate;size=size||6;var reg=null;switch(size){case 1:reg=/[^a-zA-Z]*MM.*/;break;case 2:reg=/[^a-zA-Z]*dd.*/;break;case 3:reg=/[^a-zA-Z]*hh.*/;break;case 4:reg=/[^a-zA-Z]*mm.*/;break;case 5:reg=/[^a-zA-Z]*ss.*/;break}if(reg){format=format.replace(reg,"")}return this.formatDate(date,format)},fullDate:function(date){return this.date2Str(date,dateTemplate,6).match(/\d/g).join("")},compareDate:function(source,target,size){size=size||6;var d1=this.isDate(source)?this.date2Str(source,null,size):source;var d2=this.isDate(target)?this.date2Str(target,null,size):target;return d1.match(/\d/g).join("")-d2.match(/\d/g).join("")},isToday:function(date){return this.isDate(date)?this.compareDate(date,today,3)===0:false},isTextElement:function(el){return el&&el.nodeName&&el.nodeName==="INPUT"&&el.type==="text"},tenScope:function(year){var s=Math.floor(year/10);return s+"0"+"-"+s+"9"},centuryScope:function(year){var s=Math.floor(year/100);return s+"00"+"-"+s+"99"},addMonths:function(knownDate,scale){var resultDate=new Date(knownDate);resultDate.setMonth(knownDate.getMonth()+scale+1,0);var kd=knownDate.getDate();var rd=resultDate.getDate();if(rd>kd){resultDate.setDate(kd)}return resultDate},addYears:function(knownDate,scale){var resultDate=new Date(knownDate);resultDate.setFullYear(knownDate.getFullYear()+scale,knownDate.getMonth()+1,0);var kd=knownDate.getDate();var rd=resultDate.getDate();if(rd>kd){resultDate.setDate(kd)}return resultDate}};function Calendar(date){this.init(date)}Calendar.prototype={constructor:Calendar,init:function(date){this.bus=new Date;this.d=Utils.isDate(date)?new Date(date):Utils.toDate(date,null);this.year=this.d.getFullYear()+"";this.month=Utils.lenNum(this.d.getMonth()+1);this.date=Utils.lenNum(this.d.getDate())},toStr:function(format,size){return Utils.date2Str(this.d,format,size)},setBus:function(y,m,d){this.bus.setFullYear(y,m,d)},count:function(){this.setBus(this.year,this.month,0);return this.bus.getDate()},firstDay:function(){this.setBus(this.year,this.month-1,1);return this.bus.getDay()},prev:function(mode){if(!mode){mode=viewMode.month}switch(mode){case viewMode.month:this.setBus(this.year,this.month-1,0);break;case viewMode.year:this.setBus(this.year-1,0,1);break;case viewMode.ten:this.setBus(this.year-10,0,1);break;case viewMode.century:this.setBus(this.year-100,0,1);break}return new Calendar(this.bus)},next:function(mode){if(!mode){mode=viewMode.month}switch(mode){case viewMode.month:this.setBus(this.year,this.month,1);break;case viewMode.year:this.setBus(this.year- -1,0,1);break;case viewMode.ten:this.setBus(this.year- -10,0,1);break;case viewMode.century:this.setBus(this.year- -100,0,1);break}return new Calendar(this.bus)}};function setPosition(target,modal,zIndex){var pos=target.offset();var height=target.outerHeight();var width=target.outerWidth();var $w=$(window);var wh=$w.outerHeight();var ww=$w.outerWidth();var relativeTop=pos.top-$w.scrollTop();var csser={position:"absolute",zIndex:zIndex};if(relativeTop<wh/2){csser.top=pos.top+height+1+"px";csser.bottom="auto";if(pos.left>ww/2){csser.right=ww-width-pos.left+"px";csser.left="auto"}else{csser.right="auto";csser.left=pos.left+"px"}}else{csser.top="auto";csser.bottom=wh-pos.top+1+"px";if(pos.left>ww/2){csser.right=ww-width-pos.left+"px";csser.left="auto"}else{csser.right="auto";csser.left=pos.left+"px"}}modal.css(csser)}function CalendarView(element,options){this.element=element;this.$element=$(element);this.options=options;this.init()}CalendarView.prototype={constructor:CalendarView,init:function(){this.isText=Utils.isTextElement(this.element);if(this.isText){if(this.element.value){this.calendar=new Calendar(this.element.value)}}else{this.calendar=new Calendar(this.options.date||new Date)}if(this.options.time&&this.isText&&this.calendar){var datestr=this.calendar.toStr(dateTemplate,6).match(/\d/g).join("");this.hms=datestr.substring(8);this.ymd=datestr.substr(0,8)}this.minDate=this.options.enable[0];this.maxDate=this.options.enable[1];this.wrap()},wrap:function(){var id=Utils.random("calendar");var btnCount=!!this.options.todayBtn+!!this.options.clearBtn;var h=['<div class="calendar" id="'+id+'">',' <div class="calendar-top"></div>',' <div class="calendar-body"></div>',' <div class="calendar-foot calendar-btn-count-'+btnCount+'"></div>',"</div>"];if(this.isText){$("body").append(h.join(""))}else{this.$element.append(h.join(""))}this.$wrap=$("#"+id);this.$top=this.$wrap.find(".calendar-top");this.$body=this.$wrap.find(".calendar-body");this.$foot=this.$wrap.find(".calendar-foot");if(this.options.closable){this.$wrap.addClass("calendar-closable")}if(this.options.style){this.$wrap.addClass("calendar-theme-"+this.options.style)}if(this.options.time){this.addTime()}if(this.options.todayBtn){this.addToday()}if(this.options.clearBtn){this.addClear()}if(this.options.active){this.open()}this.listen()},getTimeText:function(time,type){var attr='type="text" maxlength="2" readonly="readonly"';return"<input "+attr+' value="'+time+'" class="calendar-'+type+'"/>'},addTime:function(){var html=['<div class="calendar-time">',' <div class="calendar-time-box calendar-hour">',this.getTimeText(this.hms?this.hms.substr(0,2):"00","hour"),"  <span>"+this.options.timeText.charAt(0)+"</span>"," </div>",' <div class="calendar-time-box calendar-minute">',this.getTimeText(this.hms?this.hms.substr(2,2):"00","minute"),"  <span>"+this.options.timeText.charAt(1)+"</span>"," </div>",' <div class="calendar-time-box calendar-second">',this.getTimeText(this.hms?this.hms.substr(4,2):"00","second"),"  <span>"+this.options.timeText.charAt(2)+"</span>"," </div>",' <span class="calendar-time-edit-helper">',this.options.timeTip[0],"<span>"+this.options.timeTip[1]+"</span></span>","</div>"];this.$foot.append(html.join(""));this.timeBox=this.$foot.find('input[type="text"]');this.listenTimes()},listenTimes:function(){var that=this;var min,max;var minTime="000000",minDate=0,maxDate=0,maxTime="235959";if(this.minDate){min=Utils.fullDate(this.minDate);minDate=min.substr(0,8);minTime=min.substring(8)}if(this.maxDate){max=Utils.fullDate(this.maxDate);maxDate=max.substr(0,8);maxTime=max.substring(8)}this.timeBox.off("mouseover.focus-time").off("keydown.control-time").off("click.focus-time").off("mouseout.blur-time");this.timeBox.on("click.focus-time",function(){this.focus()}).on("mouseover.focus-time",function(){this.focus();$(this).addClass("calendar-time-focus")}).on("mouseout.blur-time",function(){$(this).removeClass("calendar-time-focus")}).on("keydown.control-time",function(e){this.focus();if(e.keyCode===38){e.preventDefault();that.addTimes(this,this.className,maxDate,maxTime)}else if(e.keyCode===40){e.preventDefault();that.reduceTimes(this,this.className,minDate,minTime)}})},addTimes:function(input,className,maxDate,maxTime){var isToday=this.ymd-maxDate===0;if(isToday&&this.hms-maxTime>=0){return false}var temp=$.map(this.timeBox,function(el){return el.value});var v=Utils.lenNum(input.value-0+1);if(className.indexOf("calendar-hour")>-1){if(v>23){return false}temp[0]=v}else if(className.indexOf("calendar-minute")>-1){if(v>59){return false}temp[1]=v}else if(className.indexOf("calendar-second")>-1){if(v>59){return false}temp[2]=v}input.value=v;if(this.isText&&this.$element.val()&&this.ymd){this.set(Utils.toDate(this.ymd,dataDateTemp))}},reduceTimes:function(input,className,minDate,minTime){var isToday=this.ymd-minDate===0;if(isToday&&this.hms-minTime<=0){return false}var temp=$.map(this.timeBox,function(el){return el.value});var v=input.value-1;if(v<0){return false}v=Utils.lenNum(v);if(className.indexOf("calendar-hour")>-1){temp[0]=v}else if(className.indexOf("calendar-minute")>-1){temp[1]=v}else if(className.indexOf("calendar-second")>-1){temp[2]=v}input.value=v;if(this.isText&&this.$element.val()&&this.ymd){this.set(Utils.toDate(this.ymd,dataDateTemp))}},addToday:function(){var html='<span class="calendar-btn calendar-today">'+this.options.todayText+"</span>";this.$foot.append(html)},addClear:function(){var html='<span class="calendar-btn calendar-clear">'+this.options.clearText+"</span>";this.$foot.append(html)},listen:function(){var that=this;if(this.isText){this.$element.on("click.toggle-calendar",function(){if(that.$wrap.hasClass("open")){closeCalendar()}else{closeCalendar();that.open()}incal=true})}this.$wrap.on("click.stop-close-calendar",function(e){if(that.$wrap.hasClass("calendar-closable")){e.stopPropagation()}});this.$top.on("click.show-prev",".calendar-left",function(){if($(this).hasClass("calendar-prev-disable")){return false}that.viewCalendar=that.viewCalendar.prev(that.viewMode);that.change()}).on("click.show-next",".calendar-right",function(){if($(this).hasClass("calendar-next-disable")){return false}that.viewCalendar=that.viewCalendar.next(that.viewMode);that.change()}).on("click.show-parent",".calendar-text",function(){that.parent()});this.$body.on("click.show-month",".calendar-cell-month",function(){var $this=$(this);if($this.hasClass("calendar-cell-ignore")){return false}var date=new Date(that.viewCalendar.year,$(this).data("month"),1);if(that.options.size===2){that.dateClick(date,$this);return false}that.viewMode=viewMode.month;that.viewCalendar=new Calendar(date);that.change()}).on("click.show-year",".calendar-cell-year",function(){var $this=$(this);if($this.hasClass("calendar-cell-ignore")){return false}that.viewMode=viewMode.year;var date=new Date($(this).data("year"),0,1);that.viewCalendar=new Calendar(date);that.change()}).on("click.show-ten",".calendar-cell-ten",function(){var $this=$(this);if($this.hasClass("calendar-cell-ignore")){return false}that.viewMode=viewMode.ten;var date=new Date($(this).data("ten"),0,1);that.viewCalendar=new Calendar(date);that.change()}).on("click.date-click",".calendar-cell-day",function(){var $this=$(this);var date=Utils.toDate($this.data("date"),dataDateTemp);that.dateClick(date,$this)});var _mouseover=this.options.dateMouseover;if($.isFunction(_mouseover)){this.$body.on("mouseover.date-mouseover",".calendar-cell-day",function(){var $this=$(this);var date=Utils.toDate($this.data("date"),dataDateTemp);_mouseover(date,$this)})}var _mouseleave=this.options.dateMouseleave;if($.isFunction(_mouseleave)){this.$body.on("mouseleave.date-mouseleave",".calendar-cell-day",function(){var $this=$(this);var date=Utils.toDate($this.data("date"),dataDateTemp);_mouseleave(date,$this)})}this.$foot.on("click.select-today",".calendar-today",function(){that.set(today).close()}).on("click.clear-calendar",".calendar-clear",function(){that.clear().close()})},change:function(){switch(this.viewMode){case viewMode.month:this.month();break;case viewMode.year:this.year();break;case viewMode.ten:this.tenYears();break;case viewMode.century:this.century();break}},parent:function(){if(this.viewMode===viewMode.month){this.year()}else if(this.viewMode===viewMode.year){this.tenYears()}else if(this.viewMode===viewMode.ten){this.century()}},top:function(){var viewText=this.viewCalendar.toStr("yyyy-MM",2);if(this.viewMode===viewMode.year){viewText=this.viewCalendar.year}else if(this.viewMode===viewMode.ten){viewText=Utils.tenScope(this.viewCalendar.year)}else if(this.viewMode===viewMode.century){viewText=Utils.centuryScope(this.viewCalendar.year)}var year=this.viewCalendar.year-0;var leftcls=year<=1e3?" calendar-prev-disable":"";var rightcls=year>=9999?" calendar-next-disable":"";if(year===1e3&&this.viewMode===viewMode.month&&this.viewCalendar.month>1){leftcls=""}else if(year===9999&&this.viewMode===viewMode.month&&this.viewCalendar.month<12){rightcls=""}var h=['<span class="calendar-left'+leftcls+'">',"<span></span><em></em>","</span>",'<div class="calendar-text">'+viewText+"</div>",'<span class="calendar-right'+rightcls+'">',"<span></span><em></em>","</span>"];this.$top.html(h.join(""))},month:function(){this.viewMode=viewMode.month;this.top();var that=this,html=[];html[0]='<ul class="calendar-week">'+this.week().join("")+"</ul>";html[1]='<ul class="calendar-month">';var count=this.viewCalendar.count(),firstDay=this.viewCalendar.firstDay(),year_month=this.viewCalendar.toStr(dataDateTemp,2),array=function(){var w=[1,2,3,4,5,6,7,1,2,3,4,5,6,7];return w.slice(6-that.options.weekStart).slice(0,7)}();var prevMonth=this.viewCalendar.prev(),prevLeft=array[firstDay],prevCount=prevMonth.count();for(var i=prevCount-prevLeft+1;i<=prevCount;i++){html.push('<li class="calendar-cell-ignore">'+i+"</li>")}for(i=1;i<=count;i++){html.push(this.day(year_month,i))}var len=42-count-prevLeft;for(i=1;i<=len;i++){html.push('<li class="calendar-cell-ignore">'+i+"</li>")}html.push("</ul>");this.$body.html(html.join(""));this.after()},day:function(year_month,date){var d1=year_month+Utils.lenNum(date),day_cls="calendar-cell-day";if(this.minDate&&Utils.compareDate(d1,this.minDate,3)<0){day_cls="calendar-cell-ignore"}if(this.maxDate&&Utils.compareDate(d1,this.maxDate,3)>0){day_cls="calendar-cell-ignore"}return'<li class="'+day_cls+'" data-date="'+d1+'">'+date+"</li>"},after:function(){var _after=this.options.after||function(){},date=this.viewCalendar.d,dateList=null,year=this.viewCalendar.year,month=this.viewCalendar.month,that=this;if($.isFunction(this.options.after)){dateList=[]}this.$body.find("[data-date]").each(function(i){var $this=$(this);date.setDate(i+1);if(dateList){dateList.push({date:new Date(date),target:$this})}if(Utils.isToday(date)){$this.addClass("calendar-cell-today")}if(that.calendar&&that.isText&&Utils.compareDate(date,that.calendar.d,3)===0){$this.addClass("calendar-cell-selected")}});_after(year,month,dateList)},week:function(){return $.map(this.options.weekText.split(/\s+/),function(day){return"<li>"+day+"</li>"})},year:function(){this.viewMode=viewMode.year;this.top();var minDate=this.minDate?Utils.formatDate(this.minDate,"yyyyMM"):0;var maxDate=this.maxDate?Utils.formatDate(this.maxDate,"yyyyMM"):1e6;var year=this.viewCalendar.year;var h=$.map(this.options.monthText.split(/\s+/),function(m,i){var cls="calendar-cell-month";var ym=year+""+Utils.lenNum(i+1);if(ym<minDate||ym>maxDate){cls+=" calendar-cell-ignore"}return'<div class="'+cls+'" data-month="'+i+'">'+m+"</div>"});this.$body.html(h.join(""))},tenYears:function(){this.viewMode=viewMode.ten;this.top();var minYear=this.minDate?this.minDate.getFullYear():0;var maxYear=this.maxDate?this.maxDate.getFullYear():1e4;var decade=Math.floor(this.viewCalendar.year/10);var startYear=""+decade+0-1;var h=[],i=0,len=12,c,d;for(;i<len;i++){c="calendar-cell-year";d=startYear+i;if(i===0||i===11||d<minYear||d>maxYear){c+=" calendar-cell-ignore"}if(d<1e3||d>9999){h.push('<div class="'+c+'"></div>')}else{h.push('<div class="'+c+'" data-year="'+d+'">'+d+"</div>")}}this.$body.html(h.join(""))},century:function(){this.viewMode=viewMode.century;this.top();var minYear=this.minDate?this.minDate.getFullYear():0;var maxYear=this.maxDate?this.maxDate.getFullYear():1e4;var cen=Math.floor(this.viewCalendar.year/100);var startYear=""+cen+"00"-10;var h=[],i=0,len=12,c,s,ten;for(;i<len;i++){c="calendar-cell-ten";s=startYear+i*10;if(i===0||i===11||s<minYear||s>maxYear){c+=" calendar-cell-ignore"}ten="<p>"+s+"-</p><p>"+(s+9)+"</p>";if(s<1e3||s>9999){h.push('<div class="'+c+'"></div>')}else{h.push('<div class="'+c+'" data-ten="'+s+'">'+ten+"</div>")}}this.$body.html(h.join(""))},dateClick:function(date,$dateObj){var fn=this.options.dateClick;if(this.isText){this.set(date);this.close()}if(typeof fn==="function"){fn(date,$dateObj)}},getErrors:function(date){var min=0,max=0;if(Utils.isDate(this.minDate)){min=Utils.compareDate(date,this.minDate,3)}if(Utils.isDate(this.maxDate)){max=Utils.compareDate(this.maxDate,date,3)}return[min,max]},enable:function(deep,start,end){if($.type(deep)!=="boolean"){end=start;start=deep;deep=false}if(deep){this.minDate=start;this.maxDate=end}else{if(Utils.isDate(start)){this.minDate=start}if(Utils.isDate(end)){this.maxDate=end}}if(this.calendar&&this.getErrors(this.calendar.d).join("").indexOf("-")>-1){this.clear()}if(!this.$wrap.hasClass("open")){return this}var viewDate=this.viewCalendar.d;var viewErrors=this.getErrors(viewDate);if(viewErrors[0]<0){this.viewCalendar=new Calendar(this.minDate)}if(viewErrors[1]<0){this.viewCalendar=new Calendar(this.maxDate)}if(this.viewMode===viewMode.month){this.month()}this.listenTimes();return this},clear:function(){this.calendar=null;if(this.isText){this.element.value=""}if(this.$wrap.hasClass("open")){this.$body.find(".calendar-cell-selected").removeClass("calendar-cell-selected")}if(this.options.time){this.$foot.find(".calendar-time").find("input").val("00")}(this.options.clear||function(){})();return this},set:function(date){if(!date){return this}if(!Utils.isDate(date)){date=Utils.toDate(date,this.options.format)}if(this.options.time){var times=this.$foot.find(".calendar-time").find("input");date.setHours(times[0].value);date.setMinutes(times[1].value);date.setSeconds(times[2].value);if(this.minDate&&Utils.compareDate(this.minDate,date,6)>0){date=new Date(this.minDate)}if(this.maxDate&&Utils.compareDate(date,this.maxDate,6)>0){date=new Date(this.maxDate)}times[0].value=Utils.lenNum(date.getHours());times[1].value=Utils.lenNum(date.getMinutes());times[2].value=Utils.lenNum(date.getSeconds())}var datestr=Utils.fullDate(date);this.hms=datestr.substring(8);this.ymd=datestr.substr(0,8);this.calendar=new Calendar(date);var scls="calendar-cell-selected";if(this.isText){this.element.value=Utils.date2Str(date,this.options.format,this.options.size)}if(this.$wrap.hasClass("open")){var d=this.viewCalendar.d,that=this;this.$body.find("."+scls).removeClass(scls);this.$body.find("[data-date]").each(function(i){d.setDate(i+1);if(Utils.compareDate(d,that.calendar.d,3)===0){$(this).addClass(scls)}})}(this.options.change||function(){})(date);return this},open:function(){var currentDate=null;if(!this.calendar){currentDate=new Date}else{currentDate=this.calendar.d}this.viewCalendar=new Calendar(currentDate);this.viewMode=this.options.size===2?viewMode.year:viewMode.month;var errors=this.getErrors(currentDate),moreThanMin=errors[0]>-1,lessThanMax=errors[1]>-1;this.$wrap.addClass("open");if(this.isText){setPosition(this.$element,this.$wrap,this.options.zIndex)}if(this.options.time){this.$foot.find(".calendar-hour").val(Utils.lenNum(currentDate.getHours()));this.$foot.find(".calendar-minute").val(Utils.lenNum(currentDate.getMinutes()));this.$foot.find(".calendar-second").val(Utils.lenNum(currentDate.getSeconds()))}if(!moreThanMin){this.viewCalendar=new Calendar(this.minDate)}if(!lessThanMax){this.viewCalendar=new Calendar(this.maxDate)}if(this.viewMode===viewMode.month){this.month()}else if(this.viewMode===viewMode.year){this.year()}return this},close:function(){this.$wrap.removeClass("open");return this},noop:function(){return this}};$.fn.calendar=function(){var params=_slice.call(arguments,0),options=params[0],data=this.data(namespace),isCommand=typeof options==="string",command="noop";if(isCommand){command=options;options={}}if(!data){options=$.extend({},config,options||{});data=new CalendarView(this[0],options);this.data(namespace,data)}if(isCommand){return data[command].apply(data,params.slice(1))}return data};function span(scopes,direct,date){var unit=scopes[0];var scale=scopes[1]-0;var resultDate=new Date(date);if(unit==="date"){resultDate.setDate(date.getDate()+direct*scale)}else if(unit==="month"){resultDate=Utils.addMonths(date,direct*scale)}else{resultDate=Utils.addYears(date,direct*scale)}return resultDate}function freshEnable(enable,date,touchable,scope,isStart){var minDate=enable[0];var maxDate=enable[1];var tempDate=null;if(isStart){if(scope.length===2){tempDate=span(scope,1,date);if(!maxDate||Utils.compareDate(tempDate,maxDate,3)<0){maxDate=tempDate}}minDate=touchable?date:date.setDate(date.getDate()+1)}else{if(scope.length===2){tempDate=span(scope,-1,date)}if(!minDate||Utils.compareDate(tempDate,minDate,3)>0){minDate=tempDate}maxDate=touchable?date:date.setDate(date.getDate()-1)}return[minDate,maxDate]}function CalendarPair(start,end,option){this.element={start:start,end:end};this.options=$.extend({},config,option);this.touchable=option.touchable;if(option.touchable==undefined){this.touchable=true}this.init()}CalendarPair.prototype={constructor:CalendarPair,init:function(){var start=this.options.start;var end=this.options.end;var startDate,endDate;var enable=this.options.enable;var touchable=this.touchable;var scope=(this.options.scope||"").split(",");var startOption=$.extend(true,{},this.options,{clearBtn:true,change:function(date){var en=freshEnable(enable,date,touchable,scope,true);end.calendar().enable(true,en[0],en[1])},clear:function(){end.calendar().enable(true,enable[0],enable[1])}});if(end.val()){endDate=Utils.toDate(end.val(),this.options.format);startOption.enable=freshEnable(enable,endDate,touchable,scope,false)}var endOption=$.extend(true,{},this.options,{clearBtn:true,change:function(date){var en=freshEnable(enable,date,touchable,scope,false);start.calendar().enable(true,en[0],en[1])},clear:function(){start.calendar().enable(true,enable[0],enable[1])}});if(start.val()){startDate=Utils.toDate(start.val(),this.options.format);endOption.enable=freshEnable(enable,startDate,touchable,scope,true)}start.calendar(startOption);end.calendar(endOption)}};$.calendarPair=function(option){return new CalendarPair(option.start,option.end,option)};function closeCalendar(){$(".calendar-closable.open").removeClass("open")}$(document).on("click.calendar-api",function(){incal?incal=false:closeCalendar()})});